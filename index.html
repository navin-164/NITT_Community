<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>College Community Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body class="bg-light">

<div class="container mt-5">
    <div class="row mb-4">
        <div class="col">
            <h1>Community Platform</h1>
            <select id="roleSelector" class="form-select w-25">
                <option value="Student">Student</option>
                <option value="Faculty">Faculty</option>
                <option value="Admin">Admin</option>
            </select>
        </div>
    </div>

    <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item"><button class="nav-link active" data-bs-target="#services" type="button">Services</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-target="#market" type="button">Marketplace</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-target="#admin" type="button">Admin Dashboard</button></li>
    </ul>

    <div class="tab-content p-4 bg-white border border-top-0">
        
        <div class="tab-pane fade show active" id="services">
            <h3>Services & Jobs</h3>
            <div class="input-group mb-3">
                <input type="text" id="jobTitle" class="form-control" placeholder="Job Title">
                <button class="btn btn-primary" onclick="postJob()">Post Job</button>
            </div>
            <small class="text-muted">*Only Faculty/Alumni can post jobs</small>
        </div>

        <div class="tab-pane fade" id="market">
            <h3>Marketplace</h3>
            <p>Buy/Sell Books, Household items...</p>
        </div>

        <div class="tab-pane fade" id="admin">
            <h3>Analytics Dashboard</h3>
            <button class="btn btn-danger mb-3" onclick="loadStats()">Refresh Stats</button>
            <ul id="statsList" class="list-group">
                </ul>
        </div>
    </div>
</div>

<script>
    const API_URL = 'http://localhost:3000/api';

    async function postJob() {
        const role = document.getElementById('roleSelector').value;
        const title = document.getElementById('jobTitle').value;
        
        const res = await fetch(`${API_URL}/services/job`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'role': role },
            body: JSON.stringify({ title, description: "Test Job", createdBy: "User1" })
        });

        if (res.status === 403) alert("Access Denied: You cannot post jobs.");
        else alert("Job Posted!");
    }

    async function loadStats() {
        const role = document.getElementById('roleSelector').value;
        if(role !== 'Admin') { alert("Access Denied"); return; }

        const res = await fetch(`${API_URL}/admin/stats`, { headers: { 'role': role } });
        const data = await res.json();
        
        const list = document.getElementById('statsList');
        list.innerHTML = '';
        data.forEach(stat => {
            list.innerHTML += `<li class="list-group-item d-flex justify-content-between align-items-center">
                ${stat.type} <span class="badge bg-primary rounded-pill">${stat.count}</span>
            </li>`;
        });
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>